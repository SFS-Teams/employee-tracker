<!DOCTYPE html>
<html>
<head>
  <title>Live Location Tracker</title>
  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwTn4ivbPy6pYrnT8bbM7WuS8-7dK244TybodlehIBTZN49JdmqHFHyg7e_a-xEPNeD/exec";

    const FIXED_LAT = 13.932811425846445;
    const FIXED_LNG = 75.54961704807373;
    const ALLOWED_RADIUS_METERS = 10;

    function getDistanceMeters(lat1, lng1, lat2, lng2) {
      function toRad(x) { return x * Math.PI / 180; }
      const R = 6371000;
      const dLat = toRad(lat2 - lat1);
      const dLng = toRad(lng2 - lng1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLng/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function submitLocation() {
      const id = document.getElementById("empId").value;
      const email = document.getElementById("email").value;

      if (!id || !email) {
        alert("⚠️ Please enter ID and Email.");
        return;
      }

      if (!navigator.geolocation) {
        alert("Geolocation not supported.");
        return;
      }

      navigator.geolocation.getCurrentPosition(position => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        const distance = getDistanceMeters(lat, lng, FIXED_LAT, FIXED_LNG);
        const status = distance <= ALLOWED_RADIUS_METERS ? "In Range" : "Out of Range";

        const data = { id, email, lat, lng, status };

        fetch(endpoint, {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
        })
        .catch(err => {
          alert("❌ Fetch Error: " + err.message);
        });
      }, err => {
        alert("❌ Geolocation error: " + err.message);
      });
    }
  </script>
</head>
<body>
  <h3>Employee Location Submit</h3>
  <label>ID: <input type="text" id="empId" /></label><br><br>
  <label>Email: <input type="email" id="email" /></label><br><br>
  <button onclick="submitLocation()">Submit Location</button>
</body>
</html>
