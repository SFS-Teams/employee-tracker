<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label, select, button { margin-top: 10px; display: block; }
  </style>
</head>
<body>

  <h2>Employee Live Tracker</h2>

  <label for="empSelect">Select Employee ID</label>
  <select id="empSelect"></select>

  <button id="submitBtn" onclick="submitOnce()">Submit First Location</button>

  <p id="status"></p>

  <script>
    // ✅ 1. Employee List
    const employeeList = [];
    for (let i = 1; i <= 90; i++) {
      const num = String(i).padStart(6, '0');
      const empId = `SFS${num}`;
      const email = `emp${i}@example.com`;
      employeeList.push({ id: empId, email: email });
    }

    const select = document.getElementById("empSelect");
    employeeList.forEach(emp => {
      const option = document.createElement("option");
      option.value = emp.id;
      option.text = emp.id;
      select.appendChild(option);
    });

    let selectedEmp = null;

    // ✅ 2. Submit once → then start tracking
    function submitOnce() {
      const selectedId = select.value;
      selectedEmp = employeeList.find(emp => emp.id === selectedId);

      if (!selectedEmp) {
        alert("Please select a valid employee.");
        return;
      }

      document.getElementById("status").innerText = `Tracking started for ${selectedEmp.id}...`;

      // First location submit
      trackAndSend();

      // Then run every 30 seconds
      setInterval(trackAndSend, 30000);
    }

    // ✅ 3. Get geolocation and send to Google Apps Script
    function trackAndSend() {
      if (!navigator.geolocation) {
        alert("Geolocation not supported.");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;

          fetch('https://script.google.com/macros/s/AKfycbz3g43-CaYmZe0jb90vuWPBv73mXYUMGgF-kL9j-C3Q/dev', {
            method: 'POST',
            body: JSON.stringify({
              id: selectedEmp.id,
              email: selectedEmp.email,
              lat: lat,
              lng: lng
            }),
            headers: { 'Content-Type': 'application/json' }
          })
          .then(res => res.text())
          .then(msg => console.log("✅ Submitted:", msg))
          .catch(err => console.error("❌ Error sending:", err));
        },
        error => {
          console.warn("⚠️ Location error:", error.message);
        }
      );
    }
  </script>

</body>
</html>
