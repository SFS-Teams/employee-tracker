<!DOCTYPE html>
<html>
  <head>
    <title>GPS Tracker with Google Login</title>
    <meta name="google-signin-client_id" content="YOUR_CLIENT_ID.apps.googleusercontent.com">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      body { font-family: Arial; padding: 20px; background: #f9f9f9; }
      h2 { color: #2c3e50; }
      #status { margin-top: 20px; font-size: 16px; color: green; }
    </style>
  </head>
  <body>
    <h2>üìç Employee GPS Tracker</h2>

    <div id="g_id_onload"
      data-client_id="YOUR_CLIENT_ID.apps.googleusercontent.com"
      data-callback="handleCredentialResponse"
      data-auto_prompt="false">
    </div>

    <div class="g_id_signin" data-type="standard"></div>

    <p id="empIdField" style="display:none;">
      <label for="empId">Employee ID</label>
      <input type="text" id="empId" placeholder="e.g., SFS900259" />
      <button onclick="startTracking()">Start Tracking</button>
    </p>

    <p id="status">Please sign in with Google to begin.</p>

    <script>
      let employeeEmail = "";
      let employeeId = "";
      const endpoint = "https://script.google.com/macros/s/AKfycbzrPDm4DoAeZ1NqlElXfh6_W8paxfmCCH0E8qrOSGMyptbsWr-hi6z1YQK7qW_ARsESLQ/exec";

      function handleCredentialResponse(response) {
        const idToken = response.credential;

        // Decode the token to extract email
        const payload = JSON.parse(atob(idToken.split('.')[1]));
        employeeEmail = payload.email;

        document.getElementById("status").innerText = `‚úÖ Logged in as ${employeeEmail}`;
        document.getElementById("empIdField").style.display = "block";
      }

      function sendLocation(lat, lng) {
        fetch(endpoint, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify({ id: employeeId, email: employeeEmail, lat: lat, lng: lng }),
          headers: { "Content-Type": "application/json" }
        }).then(() => {
          document.getElementById("status").innerText = `‚úÖ Sent location: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
        }).catch(error => {
          document.getElementById("status").innerText = "‚ùå Failed to send location.";
        });
      }

      function trackLocation() {
        if (!employeeEmail || !employeeId) return;

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            pos => {
              const lat = pos.coords.latitude;
              const lng = pos.coords.longitude;
              sendLocation(lat, lng);
            },
            err => {
              document.getElementById("status").innerText = "Location error: " + err.message;
            }
          );
        } else {
          document.getElementById("status").innerText = "Geolocation not supported.";
        }
      }

      function startTracking() {
        employeeId = document.getElementById("empId").value.trim();

        if (!employeeId) {
          alert("Please enter your Employee ID");
          return;
        }

        trackLocation(); // First one
        setInterval(trackLocation, 30000); // Every 30s
        document.getElementById("status").innerText = "üì° Tracking started...";
      }

      <script src="https://accounts.google.com/gsi/client" async defer></script>

<div id="g_id_onload"
     data-client_id="447198886782-fdk4kpsn6u32skfphbgi4nugr2d1pbik.apps.googleusercontent.com"
     data-callback="handleCredentialResponse">
</div>

<div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="sign_in_with"
     data-shape="rectangular"
     data-logo_alignment="left">
</div>

    </script>
  </body>
</html>
