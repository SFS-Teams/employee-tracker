<!DOCTYPE html>
<html>
<head>
  <title>Employee GPS Tracker</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    label, select, button { margin: 10px 0; display: block; }
    #status { margin-top: 20px; font-size: 16px; color: green; }
  </style>
</head>
<body>
  <h2>üìç Employee GPS Tracker</h2>

  <label for="empSelect">Select Employee</label>
  <select id="empSelect"></select>

  <button onclick="startTracking()">Start Tracking</button>

  <p id="status">Waiting...</p>

  <script>
    const endpoint = "PASTE_YOUR_SCRIPT_WEBAPP_URL_HERE";
    let selectedEmployee = null;
    let trackingStarted = false;

    // Load employee list from Apps Script
    fetch(endpoint)
      .then(res => res.json())
      .then(data => {
        const dropdown = document.getElementById("empSelect");
        data.forEach(emp => {
          const option = document.createElement("option");
          option.value = JSON.stringify({ id: emp.id, email: emp.email });
          option.text = `${emp.name} (${emp.email})`;
          dropdown.appendChild(option);
        });
      });

    function startTracking() {
      const emp = JSON.parse(document.getElementById("empSelect").value);
      selectedEmployee = emp;
      trackingStarted = true;
      document.getElementById("status").innerText = "‚úÖ Tracking started";

      // First send immediately, then every 30 seconds
      trackAndSend();
      setInterval(trackAndSend, 30000);
    }

    function trackAndSend() {
      if (!trackingStarted) return;

      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude } = pos.coords;

          fetch(endpoint, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              id: selectedEmployee.id,
              email: selectedEmployee.email,
              lat: latitude,
              lng: longitude
            })
          });

          document.getElementById("status").innerText =
            `üìç Sent location: ${latitude}, ${longitude}`;
        },
        err => {
          document.getElementById("status").innerText = "‚ùå Location error: " + err.message;
        }
      );
    }
  </script>
</body>
</html>
